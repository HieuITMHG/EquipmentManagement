<!-- templates/staff/equipment.html -->
{% extends "staff/layout.html" %}

{% block staff_content %}
<script>
    function showDeleteModal(equipmentId) {
        document.getElementById('delete-equipment-id').value = equipmentId;
        document.getElementById('modal-delete-equipment').style.display = 'flex';
    }
    
    function hideDeleteModal() {
        document.getElementById('modal-delete-equipment').style.display = 'none';
        document.getElementById('delete-equipment-id').value = '';
    }
</script>

<div class="flex flex-col w-full h-screen bg-gray-100 overflow-x-hidden">
    <!-- Delete Confirmation Modal -->
    <div class="fixed inset-0 bg-gray-600/50 z-50 flex items-center justify-center transition-opacity duration-300" id="modal-delete-equipment" style="display: none;">
        <div class="bg-white w-full max-w-md rounded-lg shadow-xl p-6">
            <h1 class="text-2xl font-semibold text-gray-800 mb-4">Xác nhận xóa</h1>
            <form action="{{ url_for('equipment.delete') }}" method="post">
                <input type="hidden" name="thiet_bi_id" id="delete-equipment-id" value="" />
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <div class="flex justify-end gap-3">
                    <button type="button" onclick="hideDeleteModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-200">Hủy</button>
                    <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-200">Xóa</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Statistical Cards -->
    <div class="flex w-full justify-center p-4 gap-4 flex-wrap">
        <div class="statistical_card flex-1 min-w-[180px] max-w-xs bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl shadow-lg p-6 transition-transform hover:scale-105">
            <h3 class="text-lg font-semibold">Tổng thiết bị</h3>
            <p class="text-3xl font-bold mt-2">{{ nums.total }}</p>
        </div>
        <div class="statistical_card flex-1 min-w-[180px] max-w-xs bg-gradient-to-r from-yellow-400 to-yellow-600 text-white rounded-xl shadow-lg p-6 transition-transform hover:scale-105">
            <h3 class="text-lg font-semibold">Đang sử dụng</h3>
            <p class="text-3xl font-bold mt-2">{{ nums.borrowed }}</p>
        </div>
        <div class="statistical_card flex-1 min-w-[180px] max-w-xs bg-gradient-to-r from-red-400 to-red-600 text-white rounded-xl shadow-lg p-6 transition-transform hover:scale-105">
            <h3 class="text-lg font-semibold">Hỏng</h3>
            <p class="text-3xl font-bold mt-2">{{ nums.broken }}</p>
        </div>
        <div class="statistical_card flex-1 min-w-[180px] max-w-xs bg-gradient-to-r from-gray-400 to-gray-600 text-white rounded-xl shadow-lg p-6 transition-transform hover:scale-105">
            <h3 class="text-lg font-semibold">Đã thanh lý</h3>
            <p class="text-3xl font-bold mt-2">{{ nums.liquidated }}</p>
        </div>
        <div class="statistical_card flex-1 min-w-[180px] max-w-xs bg-gradient-to-r from-purple-400 to-purple-600 text-white rounded-xl shadow-lg p-6 transition-transform hover:scale-105">
            <h3 class="text-lg font-semibold">Đã mất</h3>
            <p class="text-3xl font-bold mt-2">{{ nums.lost }}</p>
        </div>
    </div>

    <!-- Equipment Table -->
    <div class="flex-1 p-4">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-full">
            <!-- Toolbar -->
            <div class="flex items-center justify-between p-2 border-b border-gray-200">
                <form action="{{ url_for('equipment.equipment') }}" method="GET" class="flex items-center gap-2">
                    <input type="text" name="ten_thiet_bi" value="{{ request.args.get('ten_thiet_bi', '') }}"
                           placeholder="Tên thiết bị"
                           class="w-32 px-3 py-1.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                    <select name="phong_id"
                            class="w-28 px-3 py-1.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                        <option value="">Phòng</option>
                        {% for room in rooms %}
                        <option value="{{ room.id }}" {% if request.args.get('phong_id') == room.id|string %}selected{% endif %}>
                            {{ room.id }}
                        </option>
                        {% endfor %}
                    </select>
                    <select name="loai_thiet_bi"
                            class="w-28 px-3 py-1.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                        <option value="">Loại</option>
                        <option value="DI_DONG" {% if request.args.get('loai_thiet_bi') == 'DI_DONG' %}selected{% endif %}>Di động</option>
                        <option value="CO_DINH" {% if request.args.get('loai_thiet_bi') == 'CO_DINH' %}selected{% endif %}>Cố định</option>
                    </select>
                    <select name="trang_thai"
                            class="w-28 px-3 py-1.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                        <option value="">Trạng thái</option>
                        <option value="CO_SAN" {% if request.args.get('trang_thai') == 'CO_SAN' %}selected{% endif %}>Khả dụng</option>
                        <option value="DANG_MUON" {% if request.args.get('trang_thai') == 'DANG_MUON' %}selected{% endif %}>Được mượn</option>
                        <option value="HU_HONG" {% if request.args.get('trang_thai') == 'HU_HONG' %}selected{% endif %}>Hỏng</option>
                        <option value="DANG_BAO_TRI" {% if request.args.get('trang_thai') == 'DANG_BAO_TRI' %}selected{% endif %}>Đang sửa</option>
                        <option value="DA_THANH_LY" {% if request.args.get('trang_thai') == 'DA_THANH_LY' %}selected{% endif %}>Đã thanh lý</option>
                        <option value="DA_MAT" {% if request.args.get('trang_thai') == 'DA_MAT' %}selected{% endif %}>Đã mất</option>
                    </select>
                    <button type="submit"
                            class="px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm">
                        Tìm
                    </button>
                    <a href="{{ url_for('equipment.equipment') }}"
                       class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition text-sm">
                        Xóa
                    </a>
                </form>
                <a href="{{ url_for('equipment.add_equipment') }}"
                   class="px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm">
                    + Thêm
                </a>
            </div>

            <!-- Equipment Table -->
            <div class="overflow-y-auto max-h-[calc(100vh-300px)]">
                <table class="w-full table-auto border-collapse">
                    <thead class="bg-gray-200 sticky top-0 text-gray-700 z-10">
                        <tr>
                            <th class="border-b border-gray-300 p-3 text-left font-semibold w-16">ID</th>
                            <th class="border-b border-gray-300 p-3 text-left font-semibold w-1/4">Tên thiết bị</th>
                            <th class="border-b border-gray-300 p-3 text-left font-semibold w-1/6">Trạng thái</th>
                            <th class="border-b border-gray-300 p-3 text-left font-semibold w-1/6">Phòng</th>
                            <th class="border-b border-gray-300 p-3 text-left font-semibold w-1/6">Loại thiết bị</th>
                            <th class="border-b border-gray-300 p-3 text-left font-semibold w-1/6">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for e in lst_equipment %}
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="border-b border-gray-200 p-3 text-center text-gray-600">{{ e.id }}</td>
                            <td class="border-b border-gray-200 p-3 text-gray-800">{{ e.ten_thiet_bi }}</td>
                            <td class="border-b border-gray-200 p-3">
                                <span class="px-3 py-1 rounded-full text-sm font-medium
                                    {% if e.trang_thai == 'CO_SAN' %}bg-green-100 text-green-800
                                    {% elif e.trang_thai == 'DANG_MUON' %}bg-yellow-100 text-yellow-800
                                    {% elif e.trang_thai == 'HU_HONG' %}bg-red-100 text-red-800
                                    {% elif e.trang_thai == 'DANG_BAO_TRI' %}bg-blue-100 text-blue-800
                                    {% elif e.trang_thai == 'DA_THANH_LY' %}bg-gray-100 text-gray-800
                                    {% else %}bg-purple-100 text-purple-800{% endif %}">
                                    {% if e.trang_thai == 'CO_SAN' %}
                                    Khả dụng
                                    {% elif e.trang_thai == 'DANG_MUON' %}
                                    Được mượn
                                    {% elif e.trang_thai == 'HU_HONG' %}
                                    Hỏng
                                    {% elif e.trang_thai == 'DANG_BAO_TRI' %}
                                    Đang sửa
                                    {% elif e.trang_thai == 'DA_THANH_LY' %}
                                    Đã thanh lý
                                    {% else %}
                                    Đã mất
                                    {% endif %}
                                </span>
                            </td>
                            <td class="border-b border-gray-200 p-3 text-gray-600">{{ e.phong_id }}</td>
                            <td class="border-b border-gray-200 p-3 text-gray-600">
                                {% if e.loai_thiet_bi == 'DI_DONG' %}Di động{% elif e.loai_thiet_bi == 'CO_DINH' %}Cố định{% endif %}
                            </td>
                            <td class="border-b border-gray-200 p-3">
                                <div class="flex items-center justify-center gap-3">
                                    <a href="{{ url_for('equipment.edit', equipment_id=e.id) }}"
                                       class="text-green-600 hover:text-green-800 transition" title="Sửa">
                                        <img src="{{ url_for('static', filename='icon/edit_icon.svg') }}" alt="Edit" class="w-5 h-5" />
                                    </a>
                                    <button class="text-red-600 hover:text-red-800 transition cursor-pointer" title="Xóa"
                                            onclick="showDeleteModal('{{ e.id }}')">
                                        <img src="{{ url_for('static', filename='icon/delete_icon.svg') }}" alt="Delete" class="w-5 h-5" />
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}